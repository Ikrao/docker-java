node {
   
    stage('pre-build') { 
        sh '''
            sudo rm -rf docker-java
        '''
        git 'https://github.com/Ikrao/docker-java.git'
       
    }
    stage('Build') {
        
                sh '''
                pwd
                cd docker-spring-boot
                mvn clean package
                sudo docker build -t spring-boot:1.0 .
                '''
            
        
    }
    stage('run') {
        
        sh'''
                aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 492176696130.dkr.ecr.us-east-1.amazonaws.com
                docker build -t springboot .
                docker tag springboot:latest 492176696130.dkr.ecr.us-east-1.amazonaws.com/springboot:latest
                docker push 492176696130.dkr.ecr.us-east-1.amazonaws.com/springboot:latest
                sudo docker stop springboot && sudo docker rm springboot 
                sudo docker run --name springboot -d -p 8090:8080 -t spring-boot:latest
                echo 'containers running'
        '''
    }
}
